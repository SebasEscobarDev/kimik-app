import{j as e}from"./jsx-runtime.7faW4zRM.js";import{u as p,a as W,G as q}from"./GlobalContext.Bmxmn3Fz.js";import{b as O,a as Q}from"./bg-white.CDTeDQmM.js";import{s as V,a as Z}from"./instagram.BCOVGtDz.js";import{r as u}from"./index.DhYZZe0J.js";import{g as z,p as X}from"./messages.BtIvbnLZ.js";import{s as Y,C as H,a as ee,p as se,b as te,c as re}from"./kimikiaweb.D3RNarE9.js";import{c as b,g as C,u as ae,a as J}from"./consts.D182oArl.js";import{C as le}from"./index.D7_7wx8r.js";import{s as T,C as ie,H as oe}from"./CardPerfilHorizontal.BJtYajqc.js";import{s as ne}from"./img-form4.C8D0s6-p.js";import{g as ce}from"./notifies.C9F5HUp5.js";import{s as de,M as me}from"./ModalSettings.CGG43TL6.js";/* empty css                       */import{N as ue}from"./NockAlert.6Ywb4XjX.js";import"./astro/assets-service.ZirOs8Jn.js";import"./logo.DFUuHF2-.js";/* empty css                       */import"./users.CmVo9b0J.js";/* empty css                       */const fe=()=>{const{userLogin:t,chatToUser:a,claseFristLoad:n,languageText:c}=p(),[m,l]=u.useState("");return u.useEffect(()=>{n||l("hidden")},[n]),e.jsx("div",{className:`${m} chat__first-load absolute px-4 bottom-0 top-0 left-0 right-0 items-center flex bg-[#1d1d1b] border-l border-r border-white justify-center pb-[85px] overflow-y-scroll`,children:e.jsxs("div",{className:"flex flex-col text-center justify-center chat__first-load__content",children:[e.jsx("span",{className:"mb-5",children:e.jsx("img",{src:Y.src,width:60,className:"inline-block",alt:""})}),e.jsxs("span",{className:"bgDegreeSecondaryTwo text-white p-2 rounded-lg mb-3 text-sm",children:[b.txtChatKimik2[c]," ",e.jsx("b",{children:t.nombre}),e.jsx("br",{}),b.txtChatKimik[c]]}),e.jsx("span",{className:"bgDegreeSecondaryTwo text-white p-2 rounded-lg mb-3 text-sm",children:"Ingresa el número de las opciones para recibir una respuesta de Kimik IA"}),e.jsxs("span",{className:"items-center flex bgDegreeSecondaryTwo text-white p-2 rounded-lg relative mb-3 pl-10 text-left text-sm",children:[e.jsx("span",{className:"w-[25px] h-[25px] text-center items-center flex justify-center text-white bg-transparent border border-white rounded-full absolute left-2 pt-1",children:"1"})," ",e.jsxs("span",{children:["Cómo puedo iniciar una conversación con ",e.jsx("b",{children:a.nombre})]})]}),e.jsxs("span",{className:"items-center flex bgDegreeSecondaryTwo text-white p-2 rounded-lg relative mb-3 pl-10 text-left text-sm",children:[e.jsx("span",{className:"w-[25px] h-[25px] text-center items-center flex justify-center text-white bg-transparent border border-white rounded-full absolute left-2 pt-1",children:"2"})," ",e.jsxs("span",{children:["A donde le gustaria salir a ",e.jsx("b",{children:a.nombre})]})]}),e.jsxs("span",{className:"items-center flex bgDegreeSecondaryTwo text-white p-2 rounded-lg relative mb-3 pl-10 text-left text-sm",children:[e.jsx("span",{className:"w-[25px] h-[25px] text-center items-center flex justify-center text-white bg-transparent border border-white rounded-full absolute left-2 pt-1",children:"3"})," ",e.jsxs("span",{children:["Cual es la comida que mas le puede gustar a ",e.jsx("b",{children:a.nombre})]})]})]})})},he=`${ae}/irises`,F=async t=>{try{return await le.get({url:`${he}/${t}`,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+C("AuthToken")}})}catch(a){console.log(a)}};function xe(){const{userLogin:t,chatToUser:a,refDivKimik:n,refDivScrollKimik:c,messagesKimik:m,setMessagesKimik:l,setClaseFristLoad:i,claseFristLoad:f}=p(),d=u.useRef(null),[S,g]=u.useState(""),[N,v]=u.useState(!1);u.useEffect(()=>{k()},[m]);const k=()=>{c.current.scrollTop=c.current.scrollHeight};u.useEffect(()=>{A()},[t]),u.useEffect(()=>{console.log("claseFristLoad",f)},[f]);const A=async()=>{const r=await z({fromUserId:t.id,toUserId:"KimikChat"});r?.data?.rows?.length>0&&l(r.data.rows)},I=r=>{r.key==="Enter"&&U()},y=async(r,h,w)=>{let o;try{o={from_user_id:r,to_user_id:h,message:w}}catch(s){console.log(s)}return o},M=async(r,h,w)=>{const o=await y(r,h,w);return l(s=>[...s,{...o,type:o.from_user_id===t.id?"sent":"received"}]),setTimeout(()=>{k()},100),v(!1),g(""),o},U=async()=>{if(d.current.value==="")return d.current.focus();let r=d.current.value;if(d.current.value="",f){if(Number(r)>=1&&Number(r)<=4){const o=await F(t.id),s=await F(a.id);console.log("getMyPerfil",o),console.log("getMatchPerfil",s),Number(r)===1?(r="{usuario1}: "+JSON.stringify(o.data)+" {usuario2}: "+JSON.stringify(s.data)+" ",r+="Compara los perfiles psicológicos de {usuario1} y {usuario2} Basado en la comparación anterior, ¿cómo puede {usuario1} iniciar una conversación con {usuario2} de manera efectiva y empática, teniendo en cuenta sus diferencias y similitudes?"):Number(r)===2?(r="{usuario1}: "+JSON.stringify(o.data)+" {usuario2}: "+JSON.stringify(s.data)+" ",r+="Compara los perfiles psicológicos de {usuario1} y {usuario2} Teniendo en cuenta la comparación anterior, ¿a dónde le gustaría salir a {usuario2} y cómo puede {usuario1} abordar esta conversación de manera adecuada?"):Number(r)===3&&(r="{usuario1}: "+JSON.stringify(o.data)+" {usuario2}: "+JSON.stringify(s.data)+" ",r+="Consulta sobre Preferencias Alimenticias ",r+="Compara los perfiles psicológicos de {usuario1} y {usuario2} Basado en la comparación anterior, ¿cuál es la comida que más le puede gustar a {usuario2} y cómo puede {usuario1} plantear esta pregunta de manera adecuada y sensible?"),r+=" Dame una respuesta concreta a la pregunta anterior. en maximo 300 caracteres, si mencionas a {usuario1} hazlo con el nombre: "+t.nombre+" y a {usuario2} con el nombre: "+a.nombre}i(!1)}try{const o=t.id;M(o,"KimikChat",r)}catch(o){console.log(o)}const h="KimikChat",w=t.id;try{const o=await se(r,async x=>{if(!x||x.indexOf("DONE")>-1)return;v(!0);const j=await te(x);return await g(K=>K+j),k(),j}).then(x=>{const j=re(x);let K="";return j[0].indexOf("Error")>-1?K=j[0]:K=j.filter(G=>G!==void 0).join(""),K}).catch(x=>{console.log("Error:",x);const j=b.txtChatKimikFail[$];M(h,w,j)});let s="";o===""?s="Error: No hay conexion con el LLM.":s=o,M(h,w,s)}catch{M(h,w,"Error al comunicarse con el LLM:")}},{bgClass3:_,bgClass4:E,borderClass:L,textClass2:D,textClass3:B,textClass:P,languageText:$}=p();return e.jsxs("div",{ref:n,id:"divKimik",className:"hidden flex flex-col rigth-side w-full md:min-w-1/5 md:w-1/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreeSecondary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${L} w-full`,children:e.jsx("h2",{className:`flex items-center text-[19px] ${B} pop-semi`,children:"Kimik IA"})}),e.jsx("div",{className:`${_} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:c,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${L} border-t-0 w-full pt-4`,children:[e.jsx(fe,{}),e.jsx(H,{messages:m,setMessages:l,userLogin:t}),N===!0&&S!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(ee,{type:"received",message:S,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${_} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${L}`,children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:d,onKeyDown:I,className:`${E} focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${P} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":b.txtSendMessage[$],placeholder:b.txtSendMessage[$]}),e.jsx("button",{onClick:U,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const R={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function pe(){const{refChatMenuLeft:t,refDivChat:a,refDivKimik:n,refDivScrollKimik:c,refHeaderButtons:m,refDivCloseKimik:l,refDivScroll:i,refBtnKimikIA:f,chatToUser:d,setChatToUser:S,userLogin:g,messages:N,setMessages:v,isMobile:k,setVentanaUser:A,languageText:I}=p(),y=u.useRef(null),M=()=>{a.current.classList.remove("escondido"),D(),k&&t.current.classList.add("hidden")};u.useEffect(()=>{d.id&&(U(),M())},[d]),u.useEffect(()=>{const s=C("AuthToken"),x=C("User");return s!=null&&x!=null&&_(),()=>{T.off("messageReceived"),T.disconnect()}},[]);const U=async()=>{const s=await z({fromUserId:g.id,toUserId:d.id});s?.data?.rows?.length>0&&v(s.data.rows)},_=()=>{T.connect(),T.emit("myUserId",g.id),T.on("messageReceived",async s=>{console.log("message received from server"),console.log(s),v(x=>[...x,s]),D()})},E=s=>{s.key==="Enter"&&L()},L=async()=>{if(y.current.value==="")return y.current.focus();const s=await X({from_user_id:g.id,to_user_id:d.id,message:y.current.value});v([...N,{...s.data,type:s.data.from_user_id===g.id?"sent":"received"}]),y.current.value="",D()},D=()=>{setTimeout(()=>{i.current.scrollTop=i.current.scrollHeight},100)},B=()=>{setTimeout(()=>{c.current.scrollTop=c.current.scrollHeight},100)},P=async()=>{k?(A(3),a.current.classList.add("hidden")):(a.current.classList.remove("hidden"),a.current.classList.remove("md:w-4/5"),a.current.classList.add("md:w-3/5"),n.current.classList.remove("hidden"),m.current.classList.remove("w-full"),m.current.classList.add("w-4/5"),l.current.classList.remove("hidden")),n.current.classList.remove("hidden"),B()},{bgClass3:$,bgClass4:r,borderClass:h,textClass2:w,textClass:o}=p();return e.jsxs("div",{ref:a,id:"divChat",className:"escondido w-full md:flex flex-col rigth-side min-w-3/5 md:w-4/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreePrimary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${h} w-full`,children:e.jsxs("h2",{className:`${w} flex items-center gap-4 text-[19px] pop-semi`,children:[e.jsx("span",{className:`w-[50px] h-[50px] transition-all border ${h} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${d?.foto?J+"/"+d.foto:R.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),d.nombre]})}),e.jsx("div",{className:`${$} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:i,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${h} border-t-0 w-full pt-4`,children:[e.jsx(H,{messages:N,setMessages:v,userLogin:g}),e.jsxs("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${$} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${h}`,children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:y,onKeyDown:E,className:`focus:ring-2 ${r} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${o} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":b.txtSendMessage[I],placeholder:b.txtSendMessage[I]}),e.jsx("button",{onClick:L,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:f,onClick:P,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:R.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const ge=({user:t})=>{const{setChatToUser:a,setVentanaUser:n,setClaseFristLoad:c}=p(),m=async f=>{await a(f),await c(!0),n(2)},{borderClass:l,textClass:i}=p();return e.jsx("div",{className:`flex w-full border-b-2 ${l}`,children:e.jsxs("button",{type:"button",onClick:()=>m(t),className:"btn-li w-full flex p-1 my-2 items-center border-2 border-transparent hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:`img-circle w-[50px] h-[50px] transition-all border ${l} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${J}/${t.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"flex w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex-1 flex flex-col pl-2 pr-2 text-left w-full",children:[e.jsx("h4",{className:`${i} text-lg pop-semi h4-name`,children:e.jsx("span",{className:"h4-span",children:t?.nombre})}),e.jsx("small",{className:`${i} text-sm pop-regular`,children:t?.nacimiento_ciudad})]}),e.jsx("span",{className:`text-sm pop-ligth ${i} opacity-50`,children:"10:30 am."})]})})},be=()=>{const{state:t,dispatch:a,userLogin:n}=p();u.useEffect(()=>{const l=C("AuthToken"),i=C("User");if(l!=null&&i!=null){const f=JSON.parse(i).id;if(f==null)return;c(f)}},[]);async function c(l){const i=await ce({results:20,page:1,user_id:l});i?.data?.rows?.length>0&&await a({type:W.SET_CHATS,payload:i.data.rows})}const m=t.chats?.map(l=>e.jsx(ge,{user:l},l.id));return e.jsx(e.Fragment,{children:m})},we=()=>{const{bgClass3:t,bgClass4:a,borderClass:n,textClass:c,textClass3:m,refChatMenuLeft:l,languageText:i}=p();return e.jsxs("div",{id:"chatMenuLeft",ref:l,className:"flex flex-col left-side w-full md:min-w-2/5 md:w-2/5 lg:w-1/5 xl:w-1/5 md:pr-2",children:[e.jsx(ie,{btnChat:!1,btnNotify:!0,maxw:!0}),e.jsxs("div",{className:`${t} h-[90vh] md:max-h-[74vh] md:h-[74vh] flex flex-col items-center px-3 py-3 md:rounded-3xl md:border ${n} w-full`,children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:`absolute left-3 top-1/2 -mt-2.5 ${m} pointer-events-none group-focus-within:text-yellow-400`,"aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:`focus:ring-2 border ${a} ${n} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${m} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":b.txtChatMenLeft[i],placeholder:b.txtChatMenLeft[i]})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((f,d)=>e.jsx("li",{className:`${n} ${c} flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border flex items-center justify-center`,children:e.jsx("img",{src:ne.src,width:100,alt:"Perfil",className:"w-full"})},d))}),e.jsx("h2",{className:`${n} ${c} w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 `,children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(be,{})})]})]})},je=()=>{const{refDivChat:t,refDivKimik:a,refHeaderButtons:n,refDivCloseKimik:c,refBtnCloseKimik:m}=p(),l=()=>{t.current.classList.remove("md:w-3/5"),t.current.classList.add("md:w-4/5"),a.current.classList.add("hidden"),n.current.classList.add("w-full"),n.current.classList.remove("w-4/5"),c.current.classList.add("hidden")};u.useEffect(()=>{const g=C("AuthToken"),N=C("User");g!=null&&N!=null||(window.location.href="/")},[]);const{mode:i,languageText:f}=p(),[d,S]=u.useState(O.src);return u.useEffect(()=>{S(i==="dark"?O.src:Q.src)},[i]),e.jsxs("div",{style:{backgroundColor:"white",backgroundImage:`url(${d})`},className:"flex flex-col items-start h-screen w-full min-h-screen md:p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(oe,{id:"headerButtons",back:!0,refBtn:n}),e.jsx("div",{ref:c,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:m,onClick:l,children:e.jsx("img",{src:de.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row min-h-[85%] max-h-[85%]",children:[e.jsx(we,{}),e.jsx(pe,{}),e.jsx(xe,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsxs("h4",{className:"text-white",children:[b.txtCopyrigth[f]," 2024"]}),e.jsx("img",{src:V.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:Z.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},Re=()=>e.jsxs(q,{children:[e.jsx(ue,{}),e.jsx(me,{}),e.jsx(je,{})]});export{Re as default};
